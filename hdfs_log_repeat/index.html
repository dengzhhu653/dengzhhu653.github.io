<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="Zhihua Deng"><meta name="description" content="&amp;#x73B0;&amp;#x8C61;&amp;#x5728;DataNode&amp;#x7684;&amp;#x65E5;&amp;#x5FD7;&amp;#x4E2D;&amp;#xFF0C;&amp;#x6211;&amp;#x4EEC;&amp;#x53D1;&amp;#x73B0;&amp;#x6709;&amp;#x8BB8;&amp;#x591A;&amp;#x7C7B;&amp;"><meta name="keywords" content="大数据,Hadoop,DataNode,日志"><title>HDFS &quot;Not scheduling suspect block xxx for rescanning&quot;日志刷屏问题探究（1） · null</title><link rel="icon" href="../favicon.ico"><link rel="canonical" href="https://dengzhhu653.github.io/hdfs_log_repeat/"><link rel="alternate" href="../atom.xml" title="null"><link rel="stylesheet" href="../fonts/iconfont/iconfont.css"><link rel="stylesheet" href="../css/style.css"><script type="text/javascript">var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?Your baidu Analytics ID";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script type="text/javascript">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'Your Google Analytics ID', 'auto');
ga('send', 'pageview');</script></head><body><div id="main"><header><a href="../." class="logo"></a><ul class="nav"><li class="nav-link"><a href="/archives/" target="_self">归档</a></li><li class="nav-link"><a href="/about/" target="_self">关于</a></li></ul></header><section id="container"><article class="post"><h1 class="post-title">HDFS "Not scheduling suspect block xxx for rescanning"日志刷屏问题探究（1）</h1><span class="post-time">Sep 24, 2017</span><div id="sidebar" class="post-sidebar"><h3 class="heading">目录</h3><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#现象"><span class="toc-text">现象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解决思路及方案"><span class="toc-text">解决思路及方案</span></a></li></ol></div><div class="post-content"><h3 id="&#x73B0;&#x8C61;"><a href="#&#x73B0;&#x8C61;" class="headerlink" title="&#x73B0;&#x8C61;"></a>&#x73B0;&#x8C61;</h3><p>   &#x5728;DataNode&#x7684;&#x65E5;&#x5FD7;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x53D1;&#x73B0;&#x6709;&#x8BB8;&#x591A;&#x7C7B;&#x4F3C;&#x4E8E;&#xFF0C;</p>
<pre>
2016-07-01 05:53:29,328 INFO org.apache.hadoop.hdfs.server.datanode.VolumeScanner: VolumeScanner(/data12/hadoop/dfs, DS-086bc494-d862-470c-86e8-9cb7929985c6): Not scheduling suspect block BP-360285305-10.130.x.xx-1444619256876:blk_1095475173_21737939 for rescanning, because we rescanned it recently.
2016-07-01 05:53:29,330 INFO org.apache.hadoop.hdfs.server.datanode.VolumeScanner: VolumeScanner(/data12/hadoop/dfs, DS-086bc494-d862-470c-86e8-9cb7929985c6): Not scheduling suspect block BP-360285305-10.130.x.xx-1444619256876:blk_1095475173_21737939 for rescanning, because we rescanned it recently.
2016-07-01 05:53:29,334 INFO org.apache.hadoop.hdfs.server.datanode.VolumeScanner: VolumeScanner(/data12/hadoop/dfs, DS-086bc494-d862-470c-86e8-9cb7929985c6): Not scheduling suspect block BP-360285305-10.130.x.xx-1444619256876:blk_1095475173_21737939 for rescanning, because we rescanned it recently.
</pre>

<p>&#x8FD9;&#x6837;&#x7684;&#x65E5;&#x5FD7;&#xFF0C;&#x867D;&#x7136;&#x5728;<a href="https://issues.apache.org/jira/browse/HDFS-8659" target="_blank" rel="external">HDFS-8659</a>&#x4E2D;&#x6709;&#x8FC7;&#x7C7B;&#x4F3C;&#x7684;&#x63CF;&#x8FF0;&#x53CA;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF0C;&#x4F46;&#x6CA1;&#x6709;&#x5177;&#x4F53;&#x63CF;&#x8FF0;&#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x51FA;&#x73B0;&#x8FD9;&#x6837;&#x95EE;&#x9898;&#x7684;&#x539F;&#x56E0;&#x3002;&#x5728;HDFS&#x7684;&#x65E5;&#x5FD7;&#x4E0A;&#x548C;DataNode&#x8868;&#x73B0;&#x770B;&#xFF0C;&#x4E5F;&#x5E76;&#x6CA1;&#x6709;&#x4EC0;&#x4E48;&#x5F02;&#x5E38;&#x65E5;&#x5FD7;&#x6216;&#x8005;&#x73B0;&#x8C61;&#x53D1;&#x751F;&#xFF0C;&#x8FD9;&#x7ED9;&#x5982;&#x4F55;&#x627E;&#x5230;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x51FA;&#x73B0;&#x7684;&#x539F;&#x56E0;&#x5E26;&#x6765;&#x5F88;&#x5927;&#x7684;&#x56F0;&#x96BE;&#x3002;</p>
<h3 id="&#x89E3;&#x51B3;&#x601D;&#x8DEF;&#x53CA;&#x65B9;&#x6848;"><a href="#&#x89E3;&#x51B3;&#x601D;&#x8DEF;&#x53CA;&#x65B9;&#x6848;" class="headerlink" title="&#x89E3;&#x51B3;&#x601D;&#x8DEF;&#x53CA;&#x65B9;&#x6848;"></a>&#x89E3;&#x51B3;&#x601D;&#x8DEF;&#x53CA;&#x65B9;&#x6848;</h3><p>   &#x7ECF;&#x8FC7;&#x4E00;&#x4E9B;&#x6E90;&#x7801;&#x7684;&#x8DDF;&#x8E2A;&#xFF0C;&#x53D1;&#x73B0;&#x65E5;&#x5FD7;&#x5237;&#x5C4F;&#x7684;&#x539F;&#x56E0;&#x53EF;&#x80FD;&#x548C;&#x7528;&#x6237;&#x4F7F;&#x7528;HDFS&#x76F8;&#x5173;&#x3002;&#x627E;&#x51FA;&#x5176;&#x4E2D;&#x4E00;&#x53F0;DataNode&#x4E4B;&#x540E;&#xFF0C;&#x8C03;&#x4F4E;Log&#x7684;&#x65E5;&#x5FD7;&#x8F93;&#x51FA;&#x7EA7;&#x522B;(&#x4ECE;Info&#x5230;Trace), &#x679C;&#x7136;&#x5728;&#x5BF9;&#x5E94;&#x7684;&#x65E5;&#x5FD7;&#x4E0A;&#xFF0C;&#x53D1;&#x73B0;&#x4E0E;&#x95EE;&#x9898;&#x76F8;&#x5173;&#x7684;&#x5F02;&#x5E38;&#x6808;&#x4FE1;&#x606F;&#xFF1A;</p>
<pre>
2016-06-30 11:21:34,320 TRACE org.apache.hadoop.hdfs.server.datanode.DataNode: DatanodeRegistration(10.130.x.xx:50010, datanodeUuid=f3d795cc-2b3b-43b9-90c3-e4157c031d2c, infoPort=50075, infoSecurePort=0, ipcPort=50020, storageInfo=lv=-56;cid=CID-a99b693d-6f26-48fe-ad37-9f8162f70b22;nsid=920937379;c=0):Ignoring exception while serving BP-360285305-10.130.x.xx-1444619256876:blk_1105510536_31776579 to /10.130.x.xx:39933
java.net.SocketException: Original Exception : java.io.IOException: Connection reset by peer
    at sun.nio.ch.FileChannelImpl.transferTo0(Native Method)
    at sun.nio.ch.FileChannelImpl.transferToDirectlyInternal(FileChannelImpl.java:427)
    at sun.nio.ch.FileChannelImpl.transferToDirectly(FileChannelImpl.java:492)
    at sun.nio.ch.FileChannelImpl.transferTo(FileChannelImpl.java:607)
    at org.apache.hadoop.net.SocketOutputStream.transferToFully(SocketOutputStream.java:223)
    at org.apache.hadoop.hdfs.server.datanode.BlockSender.sendPacket(BlockSender.java:579)
    at org.apache.hadoop.hdfs.server.datanode.BlockSender.doSendBlock(BlockSender.java:759)
    at org.apache.hadoop.hdfs.server.datanode.BlockSender.sendBlock(BlockSender.java:706)
    at org.apache.hadoop.hdfs.server.datanode.DataXceiver.readBlock(DataXceiver.java:551)
    at org.apache.hadoop.hdfs.protocol.datatransfer.Receiver.opReadBlock(Receiver.java:116)
    at org.apache.hadoop.hdfs.protocol.datatransfer.Receiver.processOp(Receiver.java:71)
    at org.apache.hadoop.hdfs.server.datanode.DataXceiver.run(DataXceiver.java:251)
    at java.lang.Thread.run(Thread.java:745)
Caused by: java.io.IOException: Connection reset by peer
    ... 13 more
</pre>

<p>&#x4ECE;&#x8FD9;&#x6BB5;&#x65E5;&#x5FD7;&#x4FE1;&#x606F;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#x4EE5;&#x4E0B;&#x4FE1;&#x606F;&#xFF1A;</p>
<pre>
      1, &#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x8BFB;&#x64CD;&#x4F5C;(Receiver.opReadBlock)&#x3002;
      2, &#x8BFB;&#x53D6;&#x7684;block&#x4E3A;blk_1105510536_31776579&#x3002;
      3&#xFF0C;client&#x8EAB;&#x4EFD;&#x6807;&#x8BC6;&#x4E3A;CID-a99b693d-6f26-48fe-ad37-9f8162f70b22&#x3002;
      4&#xFF0C;&#x4ECE;&#x5F02;&#x5E38;&#x7684;&#x4FE1;&#x606F;&#x6765;&#x770B;&#xFF08;Connection reset by peer)&#xFF0C;DataNode&#x662F;&#x4ECE;&#x4E00;&#x4E2A;&#x5DF2;&#x7ECF;&#x88AB;&#x5BA2;&#x6237;&#x7AEF;&#x5173;&#x95ED;&#x7684;&#x8FDE;&#x63A5;&#x53D1;&#x9001;packet&#x65F6;&#x51FA;&#x73B0;&#x5F02;&#x5E38;&#x3002;
</pre>

<p>&#x4ECE;&#x670D;&#x52A1;&#x7AEF;&#x8868;&#x73B0;&#x7ED3;&#x5408;&#x65E5;&#x5FD7;&#x4E0A;&#x6765;&#x770B;&#xFF0C;&#x8FD9;&#x66F4;&#x50CF;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x53EF;&#x80FD;&#x548C;&#x7528;&#x6237;&#x5982;&#x4F55;&#x4F7F;&#x7528;&#x76F8;&#x5173;&#x3002; &#x7528;&#x6237;&#x76F8;&#x5173;&#x7684;&#x4FE1;&#x606F;&#x8868;&#x73B0;&#x5728;&#x8981;&#x8BFB;&#x53D6;&#x7684;block&#x4EE5;&#x53CA;&#x5BA2;&#x6237;&#x7AEF;&#x8EAB;&#x4EFD;&#x6807;&#x8BC6;(CID)&#xFF0C;&#x901A;&#x8FC7;CID&#x627E;&#x5230;&#x662F;&#x54EA;&#x4E2A;&#x5E94;&#x7528;&#x6709;&#x4E00;&#x4E9B;&#x56F0;&#x96BE;&#xFF0C;&#x53EF;&#x80FD;&#x662F;yarn&#x4E0A;&#x8FD0;&#x884C;&#x7684;&#x4F5C;&#x4E1A;&#xFF0C;&#x4E5F;&#x6709;&#x53EF;&#x80FD;&#x662F;&#x5982;&#x722C;&#x866B;&#x7B49;&#x5176;&#x5B83;&#x670D;&#x52A1;&#x3002;&#x770B;&#x8D77;&#x6765;&#xFF0C;&#x901A;&#x8FC7;block&#x4FE1;&#x606F;&#x5F97;&#x5230;&#x76F8;&#x5E94;&#x7684;&#x6587;&#x4EF6;&#x4FE1;&#x606F;&#xFF0C;&#x770B;&#x54EA;&#x4E9B;&#x7528;&#x6237;&#x6709;&#x64CD;&#x4F5C;&#x8FD9;&#x4E9B;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x662F;&#x4E00;&#x6761;&#x6BD4;&#x8F83;&#x5FEB;&#x6377;&#x7684;&#x65B9;&#x6CD5;&#x3002;</p>
<p>&#x5982;&#x4F55;&#x901A;&#x8FC7;block&#x627E;&#x5230;&#x5BF9;&#x5E94;&#x7684;&#x6587;&#x4EF6;&#x4FE1;&#x606F;&#x5462;&#xFF1F;&#x4E00;&#x4E2A;&#x5F88;&#x76F4;&#x63A5;&#x7684;&#x60F3;&#x6CD5;&#x662F;&#xFF0C;&#x5206;&#x6790;hdfs fsimage&#x6587;&#x4EF6;&#xFF0C;&#x5728;&#x624B;&#x5199;&#x4E00;&#x4E2A;&#x63D2;&#x4EF6;&#x540E;&#xFF1A;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line">public class BlockLookUpWriter extends  PBImageTextWriter</div><div class="line">{</div><div class="line">    private final static Logger LOG = Logger.getLogger(BlockLookUpWriter.class);</div><div class="line">    public BlockLookUpWriter(PrintStream out, String tempPath, String blockIds)</div><div class="line">       throws IOException, IllegalArgumentException{</div><div class="line">        super(out, tempPath);</div><div class="line">        String[] blks = StringUtils.split(blockIds, &apos;,&apos;);</div><div class="line">        for (String blockId : blks) {</div><div class="line">            if (blockId.startsWith(&quot;blk_&quot;)) {</div><div class="line">                blockId = blockId.substring(4);</div><div class="line">            }</div><div class="line">            int split = -1;</div><div class="line">            if ((split = blockId.indexOf(&quot;_&quot;)) &gt; 0) {</div><div class="line">                blockId = blockId.substring(0, split);</div><div class="line">            }</div><div class="line">            Pattern pattern = Pattern.compile(&quot;^\\d+$&quot;);</div><div class="line">            Matcher matcher = pattern.matcher(blockId);</div><div class="line">            if (!matcher.find())</div><div class="line">                throw new IllegalArgumentException(&quot;blockIds: &quot; + blockIds);</div><div class="line">            blockMapping.put(Long.parseLong(blockId), &quot;&quot;);</div><div class="line">        }</div><div class="line"></div><div class="line">        if (blockMapping.isEmpty())</div><div class="line">           throw new IllegalArgumentException(&quot;blockIds: &quot; + blockIds);</div><div class="line">    }</div><div class="line"></div><div class="line">    private final Map&lt;Long, String&gt; blockMapping = new HashMap&lt;&gt;();</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected String getEntry(String parent, FsImageProto.INodeSection.INode inode) {</div><div class="line">       if (FsImageProto.INodeSection.INode.Type.FILE == inode.getType()) {</div><div class="line">           FsImageProto.INodeSection.INodeFile file = inode.getFile();</div><div class="line">           List&lt;HdfsProtos.BlockProto&gt; blocks = file.getBlocksList();</div><div class="line">           for (HdfsProtos.BlockProto bp : blocks) {</div><div class="line">               if (blockMapping.containsKey(bp.getBlockId())) {</div><div class="line">                  String fileName = inode.getName().toStringUtf8();</div><div class="line">                  if (!parent.endsWith(&quot;/&quot;)) {</div><div class="line">                      parent = parent + &quot;/&quot;;</div><div class="line">                  }</div><div class="line">                  this.blockMapping.put(bp.getBlockId(), parent + fileName);</div><div class="line">                  LOG.info(&quot;found block: blk_&quot; + bp.getBlockId() + &quot;, fileName: &quot; + (parent + fileName));</div><div class="line">               }</div><div class="line">           }</div><div class="line">	</div><div class="line">       }</div><div class="line">       return null;</div><div class="line">    }</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void opOnEntry(String entry) {</div><div class="line">      //do nothing</div><div class="line">    }</div><div class="line"></div><div class="line">    public void print() throws IOException {</div><div class="line">      for (Map.Entry&lt;Long, String&gt; entry : blockMapping.entrySet()) {</div><div class="line">          out.println( &quot;blk_&quot; + entry.getKey() + &quot;:&quot; + entry.getValue());</div><div class="line">      }</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure></p>
<p>&#x5229;&#x7528;&#x8FD9;&#x4E2A;&#x7C7B;&#x6765;&#x627E;&#x51FA;&#x5BF9;&#x5E94;&#x7684;&#x6587;&#x4EF6;(java -cp), &#x53D1;&#x73B0;&#x8FD9;&#x4E9B;blk&#x4FE1;&#x606F;&#x5BF9;&#x5E94;&#x7684;&#x6587;&#x4EF6;&#x7ADF;&#x7136;&#x662F;HBase HFile&#x6587;&#x4EF6;(&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x5176;&#x5B9E;&#x8D70;&#x4E86;&#x4E00;&#x4E9B;&#x5F2F;&#x8DEF;&#xFF0C;&#x5728;&#x6211;&#x4EEC;&#x7684;hadoop&#x7248;&#x672C;(2.7.1)&#x4E0A;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x901A;&#x8FC7;hdfs&#x547D;&#x4EE4;&#x53EF;&#x4EE5;&#x83B7;&#x53D6;blk&#x5BF9;&#x5E94;&#x7684;&#x6587;&#x4EF6;&#x4FE1;&#x606F;)&#xFF1A;</p>
<p><pre><br>/hbase/data/yisou/unifer_jhjj/053bc95da7a6fc9c4856cb92cfcbdce2/data/f7239ccdd9194c388b772a6117bd12ca<br>/hbase/data/yisou/unifer_jhjj/63db62674aeea84ade0fc291c6f9370d/data/8f7966c3a64240b2b9ed1b50db3d1b0c<br>/hbase/data/yisou/unifer_jhjj/be1bafb3804974673b73001e0ba9a656/data/7f733cad1f1b4b2790a6019208f05d24<br></pre><br>&#x7ECF;&#x8FC7;&#x4E00;&#x756A;&#x6392;&#x67E5;&#xFF0C;&#x53EF;&#x4EE5;&#x5927;&#x6982;&#x7387;&#x7684;&#x786E;&#x5B9A;&#xFF0C;&#x8FD9;&#x4E2A;&#x548C;RegionServer&#x4F7F;&#x7528;HDFS&#x76F8;&#x5173;&#x3002;</p>
<p>&#x627E;&#x5230;&#x65B9;&#x5411;&#x540E;&#xFF0C;&#x719F;&#x6089;&#x4E86;&#x4E00;&#x4E0B;&#x5BA2;&#x6237;&#x7AEF;&#x5982;&#x4F55;&#x8BFB;&#x53D6;HDFS&#x6587;&#x4EF6;&#x4E0A;&#x7684;&#x6E90;&#x7801;&#xFF0C;&#x7ED3;&#x5408;DataNode&#x4E0A;&#x7684; <em>java.io.IOException: Connection reset by peer</em> &#x5F02;&#x5E38;&#xFF0C;&#x8BD5;&#x56FE;&#x89E3;&#x91CA;&#x95EE;&#x4EC0;&#x4E48;client&#x8981;&#x5173;&#x95ED;&#x8FDE;&#x63A5;&#x3002; &#x68B3;&#x7406;DFSInputStream&#x7684;&#x521B;&#x5EFA;&#x903B;&#x8F91;&#xFF0C;</p>
<p><pre><br> &#x521B;&#x5EFA;&#x4E00;&#x4E2A; InputStream  &#x2014;&gt; BlockReaderFactory&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;BlockReader<br>                                           blockReader&#x4E2D;&#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#x4E0E;DN&#x76F8;&#x5173;&#x7684;&#x8F93;&#x5165;&#x8F93;&#x51FA;&#x6D41;<br>          &#x521B;&#x5EFA;&#x6D41;&#x7684;&#x8FC7;&#x7A0B;&#xFF1A;<br>              if(PeerCache&#x4E2D;&#x5305;&#x542B;&#x4E0E;DN&#x7684;&#x8FDE;&#x63A5; &amp;&amp; &#x8BE5;blockreader&#x4F7F;&#x7528;&#x7F13;&#x5B58;&#x8FDE;&#x63A5;&#x7684;&#x6B21;&#x6570;  &lt; 3 &#xFF09; {<br>                   1&#xFF0C; &#x4ECE;&#x7F13;&#x5B58;&#x4E2D;&#x53D6;&#x51FA;&#x6539;&#x8FDE;&#x63A5;&#xFF0C; &#x5E76;&#x5C06;&#x8BE5;&#x8FDE;&#x63A5;&#x4ECE;PeerCache&#x4E2D;&#x79FB;&#x9664;<br>                   2&#xFF0C; &#x5229;&#x7528;&#x8BE5;&#x8FDE;&#x63A5;&#x521B;&#x5EFA;&#x6B64;&#x6B21;&#x8BFB;&#x8FC7;&#x7A0B;&#x7684;&#x8F93;&#x5165;&#x8F93;&#x51FA;&#x6D41;<br>             }   else {<br>                    &#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x8FDE;&#x63A5;<br>             }<br></pre><br>&#x5728;&#x5173;&#x95ED;&#x8FDE;&#x63A5;&#x65F6;&#xFF0C;&#x5224;&#x65AD;&#x8BE5;&#x8FDE;&#x63A5;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x88AB;&#x8BFB;&#x53D6;&#x5B8C;&#x6BD5;&#xFF0C;&#x5982;&#x679C;&#x8BFB;&#x53D6;&#x5B8C;&#x6BD5;&#xFF0C;&#x5219;&#x8BA4;&#x4E3A;&#x662F;&#x4E00;&#x4E2A;&#x5E72;&#x51C0;&#x7684;&#x8FDE;&#x63A5;&#xFF0C; &#x53EF;&#x4EE5;&#x5C06;&#x8BE5;&#x8FDE;&#x63A5;&#x4EA4;&#x7ED9;PeerCache&#x6765;&#x7BA1;&#x7406;&#xFF0C;&#x5426;&#x5219;&#x8C03;&#x7528;close&#x65B9;&#x6CD5;&#x6765;&#x5F3A;&#x5236;&#x5173;&#x95ED;&#x8FDE;&#x63A5;&#x3002;PeerCache&#x7EF4;&#x62A4;&#x7F13;&#x5B58;&#x7684;&#x8FDE;&#x63A5;&#xFF0C;&#x5C06;&#x8FC7;&#x671F;&#x7684;&#x8FDE;&#x63A5;&#x4ECE;&#x7F13;&#x5B58;&#x4E2D;&#x79FB;&#x9664;&#xFF0C;&#x5E76;&#x7EF4;&#x62A4;&#x7F13;&#x5B58;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x8FDE;&#x63A5;&#x7684;&#x8FC7;&#x671F;&#x65F6;&#x95F4;&#x9ED8;&#x8BA4;&#x4E3A;3s, &#x7F13;&#x5B58;&#x5927;&#x5C0F;&#x4E3A;16&#x3002;&#x7531;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x53EF;&#x77E5;&#xFF0C; &#x4E00;&#x4E2A;&#x8F93;&#x5165;&#x6D41;&#x5B9E;&#x4F8B;&#x5BF9;&#x5E94;&#x4E00;&#x4E2A;&#x8FDE;&#x63A5;&#x5B9E;&#x4F8B;&#xFF0C; &#x540C;&#x4E00;&#x65F6;&#x523B;&#x4E0D;&#x5B58;&#x5728;&#x4E24;&#x4E2A;&#x8F93;&#x5165;&#x6D41;&#x5B9E;&#x4F8B;&#x8D21;&#x732E;&#x540C;&#x4E00;&#x4E2A;&#x8FDE;&#x63A5;&#x5B9E;&#x4F8B;&#x3002; &#x5171;&#x4EAB;&#x540C;&#x4E00;&#x4E2A;&#x8FDE;&#x63A5;&#x5B9E;&#x4F8B;&#x7684;&#x8F93;&#x5165;&#x6D41;&#x6709;&#x5148;&#x540E;&#x987A;&#x5E8F;&#x3002;<br></p>
<p>&#x4E00;&#x4E2A;InputStream close&#x64CD;&#x4F5C;&#x53D1;&#x751F;&#x7684;&#x65F6;&#x673A;&#xFF1A;<br><br>  1&#xFF0C; &#x4E0A;&#x5C42;&#x663E;&#x5F0F;&#x8C03;&#x7528;&#xFF1B;<br><br>  2&#xFF0C; DFSInputStream&#x8BFB;&#x53D6;&#x65F6;block&#x5207;&#x6362;&#x6216;&#x8005;DN&#x5BB9;&#x9519;(&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x53D1;&#x751F;&#x5728;&#x4E0E;DN&#x901A;&#x4FE1;&#x6709;&#x95EE;&#x9898;&#x6216;&#x8005;&#x53D1;&#x751F;checksum error&#x9519;&#x8BEF;&#x65F6;&#x53D1;&#x751F;&#x3002;<br><br>  3&#xFF0C; PeerCache&#x79FB;&#x9664;&#x8FC7;&#x671F;&#x7684;&#x8FDE;&#x63A5;&#x3002;<br><br> &#x4E5F;&#x5373;&#xFF0C; &#x8FDE;&#x63A5;&#x7684;close&#x64CD;&#x4F5C;&#x662F;&#x7531;&#x552F;&#x4E00;&#x7684;&#x8F93;&#x5165;&#x6D41;&#x672C;&#x8EAB;&#x6765;&#x63A7;&#x5236;&#x7684;&#xFF0C; &#x7ED3;&#x5408;&#x4E4B;&#x524D;&#x51FA;&#x73B0;&#x7684;&#x5F02;&#x5E38;&#xFF0C;&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#x4EE5;&#x4E0B;&#x7ED3;&#x8BBA;&#xFF1A;<br></p>
<p>  <strong> &#x7B2C;&#x4E09;&#x79CD;&#x60C5;&#x51B5;&#xFF0C; &#x7531;PeerCache&#x6765;&#x5173;&#x95ED;&#x8FDE;&#x63A5;&#xFF0C; PeerCache&#x7BA1;&#x7406;&#x7684;&#x8FDE;&#x63A5;&#x662F;&#x4E00;&#x6761;&#x5E72;&#x51C0;&#x7684;&#x8FDE;&#x63A5;&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x8FDE;&#x63A5;&#x6CA1;&#x6709;&#x6267;&#x884C;&#x4E0A;&#x4E0B;&#x6587;(&#x53EF;&#x7C7B;&#x6BD4;&#x6700;&#x521D;&#x65B0;&#x5EFA;&#x7ACB;&#x7684;&#x8FDE;&#x63A5;)&#xFF0C;&#x4ECE;DN&#x629B;&#x51FA;&#x7684;&#x5F02;&#x5E38;&#x6765;&#x770B;&#xFF0C;&#x8FDE;&#x63A5;&#x8FD8;&#x5728;&#x670D;&#x52A1;&#x8BF7;&#x6C42;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#xFF0C;&#x56E0;&#x6B64;&#x6392;&#x51FA;&#x7531;PeerCache&#x6765;&#x5173;&#x95ED;&#x8FDE;&#x63A5;&#x7684;&#x53EF;&#x80FD;&#x6027;&#x3002;</strong><br><br>  <strong> &#x7B2C;&#x4E8C;&#x79CD;&#x60C5;&#x51B5;&#xFF0C; &#x4F7F;&#x7528;hdfs fsck&#x547D;&#x4EE4;&#x68C0;&#x67E5;&#x8BE5;blk&#x65F6;&#xFF0C;&#x5E76;&#x672A;&#x53D1;&#x751F;checksum&#x53D1;&#x751F;&#x9519;&#x8BEF;&#x7684;block&#x5757;&#xFF0C;&#x6392;&#x51FA;checksum error&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x4E5F;&#x5E76;&#x975E;DN&#x7684;&#x95EE;&#x9898;&#xFF0C; &#x5728;hbase&#x7684;region&#x4E2D;&#x4E5F;&#x672A;&#x53D1;&#x73B0;&#x8FD9;&#x6837;&#x7C7B;&#x4F3C;&#x7684;&#x65E5;&#x5FD7;&#x3002;&#xFF08;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x8FD8;&#x9700;&#x786E;&#x5B9A;)</strong><br><br></p>
<p>  &#x518D;&#x5206;&#x6790;&#x4E00;&#x4E0B;HDFS&#x7684;&#x65E5;&#x5FD7;&#xFF1A;<br> <pre><br>2016-07-07 19:41:41,077 INFO org.apache.hadoop.hdfs.server.datanode.DataNode.clienttrace: src: /10.130.1.29:50010, dest: /10.130.1.48:35358, bytes: 327680, op: HDFS_READ, cliID: DFSClient_NONMAPREDUCE_1151551783_1, offset: 44174336, srvID: f3d795cc-2b3b-43b9-90c3-e4157c031d2c, blockid: BP-360285305-10.130.1.11-1444619256876:blk_1108372123_34638287, duration: 13597476738896301, endOffset:50168268<br>2016-07-07 19:41:41,426 INFO org.apache.hadoop.hdfs.server.datanode.DataNode.clienttrace: src: /10.130.1.29:50010, dest: /10.130.1.48:35364, bytes: 327680, op: HDFS_READ, cliID: DFSClient_NONMAPREDUCE_1151551783_1, offset: 44240384, srvID: f3d795cc-2b3b-43b9-90c3-e4157c031d2c, blockid: BP-360285305-10.130.1.11-1444619256876:blk_1108372123_34638287, duration: 13597477088563567, endOffset:50168268<br>2016-07-07 19:41:41,643 INFO org.apache.hadoop.hdfs.server.datanode.DataNode.clienttrace: src: /10.130.1.29:50010, dest: /10.130.1.48:35368, bytes: 393216, op: HDFS_READ, cliID: DFSClient_NONMAPREDUCE_1151551783_1, offset: 44305920, srvID: f3d795cc-2b3b-43b9-90c3-e4157c031d2c, blockid: BP-360285305-10.130.1.11-1444619256876:blk_1108372123_34638287, duration: 13597477304937745, endOffset:50168268<br>2016-07-07 19:41:41,844 INFO org.apache.hadoop.hdfs.server.datanode.DataNode.clienttrace: src: /10.130.1.29:50010, dest: /10.130.1.48:35373, bytes: 327680, op: HDFS_READ, cliID: DFSClient_NONMAPREDUCE_1151551783_1, offset: 44437504, srvID: f3d795cc-2b3b-43b9-90c3-e4157c031d2c, blockid: BP-360285305-10.130.1.11-1444619256876:blk_1108372123_34638287, duration: 13597477506783816, endOffset:50168268<br>2016-07-07 19:41:42,290 INFO org.apache.hadoop.hdfs.server.datanode.DataNode.clienttrace: src: /10.130.1.29:50010, dest: /10.130.1.48:35377, bytes: 262144, op: HDFS_READ, cliID: DFSClient_NONMAPREDUCE_1151551783_1, offset: 44503040, srvID: f3d795cc-2b3b-43b9-90c3-e4157c031d2c, blockid: BP-360285305-10.130.1.11-1444619256876:blk_1108372123_34638287, duration: 13597477952726051, endOffset:50168268<br>2016-07-07 19:41:42,541 INFO org.apache.hadoop.hdfs.server.datanode.DataNode.clienttrace: src: /10.130.1.29:50010, dest: /10.130.1.48:35389, bytes: 589824, op: HDFS_READ, cliID: DFSClient_NONMAPREDUCE_1151551783_1, offset: 44568576, srvID: f3d795cc-2b3b-43b9-90c3-e4157c031d2c, blockid: BP-360285305-10.130.1.11-1444619256876:blk_1108372123_34638287, duration: 13597478203646763, endOffset:50168268<br>2016-07-07 19:41:42,761 INFO org.apache.hadoop.hdfs.server.datanode.DataNode.clienttrace: src: /10.130.1.29:50010, dest: /10.130.1.48:35393, bytes: 327680, op: HDFS_READ, cliID: DFSClient_NONMAPREDUCE_1151551783_1, offset: 44766208, srvID: f3d795cc-2b3b-43b9-90c3-e4157c031d2c, blockid: BP-360285305-10.130.1.11-1444619256876:blk_1108372123_34638287, duration: 13597478422925409, endOffset:50168268<br>2016-07-07 19:41:42,954 INFO org.apache.hadoop.hdfs.server.datanode.DataNode.clienttrace: src: /10.130.1.29:50010, dest: /10.130.1.48:35396, bytes: 327680, op: HDFS_READ, cliID: DFSClient_NONMAPREDUCE_1151551783_1, offset: 44963328, srvID: f3d795cc-2b3b-43b9-90c3-e4157c031d2c, blockid: BP-360285305-10.130.1.11-1444619256876:blk_1108372123_34638287, duration: 13597478616454260, endOffset:50168268<br>2016-07-07 19:41:43,305 INFO org.apache.hadoop.hdfs.server.datanode.DataNode.clienttrace: src: /10.130.1.29:50010, dest: /10.130.1.48:35402, bytes: 327680, op: HDFS_READ, cliID: DFSClient_NONMAPREDUCE_1151551783_1, offset: 45028864, srvID: f3d795cc-2b3b-43b9-90c3-e4157c031d2c, blockid: BP-360285305-10.130.1.11-1444619256876:blk_1108372123_34638287, duration: 13597478967544152, endOffset:50168268<br>2016-07-07 19:41:43,530 INFO org.apache.hadoop.hdfs.server.datanode.DataNode.clienttrace: src: /10.130.1.29:50010, dest: /10.130.1.48:35414, bytes: 196608, op: HDFS_READ, cliID: DFSClient_NONMAPREDUCE_1151551783_1, offset: 45094912, srvID: f3d795cc-2b3b-43b9-90c3-e4157c031d2c, blockid: BP-360285305-10.130.1.11-1444619256876:blk_1108372123_34638287, duration: 13597479192103744, endOffset:50168268<br></pre><br>&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C; &#x540C;&#x4E00;&#x4E2A;DFSClient&#x662F;&#x5411;DN&#x53D1;&#x8D77;&#x591A;&#x6B21;&#x4E0D;&#x540C;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x8BF7;&#x6C42;&#x540C;&#x4E00;&#x4E2A;block&#x3002;&#x8FD9;&#x4E9B;&#x4E0D;&#x540C;&#x7684;&#x8BF7;&#x6C42;&#x6709;&#x7740;&#x76F8;&#x540C;&#x7684;endOffset, &#x5176;&#x4E2D;&#x5229;&#x7528;&#x8FD9;&#x4E9B;&#x4FE1;&#x606F;&#xFF0C; &#x53EF;&#x83B7;&#x5F97;&#x4E00;&#x4E2A;&#x5927;&#x81F4;&#x7684;&#x8BF7;&#x6C42;&#x56FE;&#xFF1A;</p>
<p><pre><br> | &#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x6570;&#x636E;&#x533A;&#x95F4; &#xFF0D;&#xFF0D;&#xFF0D;&#xFF0D;&#xFF0D;&#xFF0D;&#xFF0D;&#xFF0D;&#xFF0D;&#xFF0D;&#xFF0D;&#xFF0D;&#xFF0D;&#xFF0D;&#xFF5C;<br> | &#xFF0D;&#xFF0D;&#xFF5C;  -&gt; 1<br>         |&#x2014;&#x2014;| -&gt;2<br>               |&#x2014;&#x2014;| -&gt;3<br>                     |&#x2014;&#x2014;&#x2014;| -&gt;4<br>                               |&#x2014;&#x2014;&#x2014;| -&gt;5<br>                                       &#x2026;.<br>  &#xFF0D;&#xFF0D;&#xFF0D;&#xFF0D;&#xFF0D;&#xFF0D;&#xFF0D;&#xFF0D;&#xFF0D;&#xFF0D;&gt; &#x65F6;&#x95F4;<br></pre><br>&#x8FD9;&#x4E9B;&#x8BF7;&#x6C42;&#x5728;&#x65F6;&#x95F4;&#x4E0A;&#x4E5F;&#x6709;&#x4E25;&#x683C;&#x7684;&#x5148;&#x540E;&#x987A;&#x5E8F;&#xFF08;&#x4ECE;&#x4E4B;&#x524D;&#x7684;&#x65E5;&#x5FD7;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;&#x8FD9;&#x90E8;&#x5206;&#x65E5;&#x5FD7;&#x7684;duration&#x503C;&#x662F;&#x5F53;&#x524D;&#x65F6;&#x95F4;&#x7684;ns&#x8868;&#x793A;)&#xFF0C; &#x53EF;&#x4EE5;&#x5047;&#x8BBE;&#xFF0C;&#x8FD9;&#x4E9B;&#x8BF7;&#x6C42;&#x90FD;&#x5F52;&#x5C5E;&#x4E8E;&#x67D0;&#x4E00;&#x4E2A;&#x6BD4;&#x8F83;&#x5927;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x7528;&#x4E8E;&#x67D0;&#x79CD;&#x539F;&#x56E0;&#xFF0C;&#x8FD9;&#x4E9B;&#x8BF7;&#x6C42;&#x88AB;&#x5206;&#x5272;&#x6210;&#x8FD9;&#x4E9B;&#x5C0F;&#x8BF7;&#x6C42;&#x3002;<br>&#x5206;&#x6790;DFSInputStream&#x7684;read&#x65B9;&#x6CD5;&#xFF0C;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">read(final byte buf[], int off, int len)  </div><div class="line">                -&gt; readWithStrategy(ReaderStrategy strategy, int off, int len)</div><div class="line">                           &#x5206;&#x4E3A;&#x4E24;&#x6B65;&#xFF1A;</div><div class="line">                              1&#xFF0C; int result = readBuffer(strategy, off, realLen, corruptedBlockMap);  realLen &#x662F;&#x6B64;&#x6B21;read&#x64CD;&#x4F5C;&#x6700;&#x5927;&#x8BFB;&#x53D6;&#x7684;&#x5B57;&#x8282;&#x6570;&#xFF0C;&#x8FD9;&#x4E2A;&#x548C;&#x7528;&#x6237;&#x7ED9;&#x4E86;&#x591A;&#x5927;&#x7684;buffer&#x4EE5;&#x53CA;&#x5F53;&#x524D;&#x8981;&#x8BFB;&#x53D6;&#x7684;block&#x5269;&#x4F59;&#x5927;&#x5C0F;&#x76F8;&#x5173;&#x3002;</div><div class="line">                              2&#xFF0C; pos += result,  &#x79FB;&#x52A8;pos</div><div class="line">                 -&gt;  return result</div><div class="line"></div><div class="line">&#x5728;&#x4E0A;&#x4E00;&#x6B65;&#x7684;readBuffer&#x4E2D;&#xFF0C; </div><div class="line">       readBuffer(strategy, off, realLen, corruptedBlockMap) </div><div class="line">            -&gt; return reader.doRead(blockReader, off, len); </div><div class="line">                -&gt; &#x8C03;&#x7528;RemoteBlockReader2&#x7684;reader.doRead(blockReader, off, len);&#x65B9;&#x6CD5;&#xFF0C;&#x5728;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x5C06;&#x5E95;&#x5C42;&#x8BFB;&#x53D6;&#x7684;&#x6570;&#x636E;&#x62F7;&#x8D1D;&#x5230;&#x7528;&#x6237;&#x7684;buf&#x4E2D;&#xFF0C;&#x62F7;&#x8D1D;&#x6570;&#x636E;&#x7684;&#x5927;&#x5C0F;&#x4E3A;min{buf&#x9700;&#x8981;&#x8BFB;&#x53D6;&#x7684;len&#xFF0C; &#x5E95;&#x5C42;&#x5269;&#x4F59;&#x5F85;&#x62F7;&#x8D1D;&#x7684;&#x5B57;&#x8282;&#x6570;&#xFF5D;&#xFF0C;&#x5F53;&#x5E95;&#x5C42;&#x6570;&#x636E;&#x90FD;&#x88AB;&#x62F7;&#x8D1D;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x518D;&#x9700;&#x8981;&#x8BFB;&#x53D6;&#x65F6;&#xFF0C;&#x5219;&#x7EE7;&#x7EED;&#x8BFB;&#x53D6;&#x4E00;&#x4E2A;packet&#x7684;&#x6570;&#x636E;&#x91CF;&#x3002;</div><div class="line">                -&gt; &#x53D1;&#x751F;&#x5F02;&#x5E38;&#x65F6;(CheckSumException&#x9664;&#x5916;), &#x5C1D;&#x8BD5;&#x4E0E;&#x5F53;&#x524D;&#x7684;datanode&#x91CD;&#x65B0;&#x5EFA;&#x7ACB;&#x4E00;&#x6761;&#x65B0;&#x7684;&#x8FDE;&#x63A5;,  &#x518D;&#x6B21;&#x8BFB;&#x53D6;&#x6570;&#x636E;&#xFF0C;</div></pre></td></tr></table></figure></p>
<p>&#x6BCF;&#x4E00;&#x6B21;&#x53D1;&#x751F;&#x6570;&#x636E;&#x7684;&#x62F7;&#x8D1D;&#xFF0C; DFSInputStream&#x7684;&#x5B9E;&#x4F8B;&#x90FD;&#x4F1A;&#x5C06;pos += result, &#x5F53;&#x62F7;&#x8D1D;&#x53D1;&#x751F;&#x5F02;&#x5E38;&#x65F6;&#xFF0C;DFSInputStream&#x4F1A;&#x4ECE;&#x4E0A;&#x6B21;&#x8BFB;&#x53D6;&#x6210;&#x529F;&#x7684;&#x4F4D;&#x7F6E;&#xFF08;pos&#xFF09;&#x4ECE;&#x65B0;&#x5C1D;&#x8BD5;&#x4E0E;&#x5F53;&#x524D;&#x7684;DataNode&#x521B;&#x5EFA;&#x4E00;&#x6761;&#x65B0;&#x7684;&#x8FDE;&#x63A5;&#xFF0C; &#x8FD9;&#x4E0E;&#x5F53;&#x524D;DataNode&#x8FD9;&#x6837;&#x7684;&#x65E5;&#x5FD7;&#x8F93;&#x51FA;&#x7B26;&#x5408;&#xFF0C;<br>&#x4E5F;&#x5C31;&#x662F;&#x8BF7;&#x6C42;2&#x4E4B;&#x524D;&#xFF0C; DFSInputStream&#x8BFB;&#x53D6;&#x8BF7;&#x6C42;1&#x7684;&#x6570;&#x636E;&#x5931;&#x8D25;&#xFF0C; &#x5C1D;&#x8BD5;&#x91CD;&#x65B0;&#x4E0E;c1-hd-dn10&#x5EFA;&#x7ACB;&#x4E00;&#x6761;&#x65B0;&#x7684;&#x8FDE;&#x63A5;(&#x8BF7;&#x6C42;2&#xFF09;&#xFF0C; &#x4ECE;&#x65B0;&#x8FDE;&#x63A5;&#x4E2D;&#x8BFB;&#x53D6;&#x76F8;&#x5E94;&#x91CF;&#x7684;&#x6570;&#x636E;&#x5E76;&#x6210;&#x529F;&#x8FD4;&#x56DE;&#x6B64;&#x6B21;&#x7684;&#x8BFB;&#x53D6;&#x8FC7;&#x7A0B;&#xFF0C; &#x5F53;&#x7528;&#x6237;&#x8BFB;&#x53D6;n&#x6B21;&#x64CD;&#x4F5C;&#x540E;( &#x5373;&#x91CD;&#x590D;&#x8C03;&#x7528;n&#x6B21;DFSInputStream&#x7684;read&#x65B9;&#x6CD5;&#xFF09;&#xFF0C;&#x6B64;&#x65F6;&#x53D1;&#x751F;&#x5F02;&#x5E38;&#xFF0C;&#x91CD;&#x65B0;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;3&#xFF0C;&#x7EE7;&#x7EED;&#x5F80;&#x4E0A;&#x6B21;&#x6210;&#x529F;&#x8BFB;&#x53D6;&#x7684;&#x5730;&#x65B9;&#x5F00;&#x59CB;&#x8BFB;&#x53D6;&#xFF0C;&#x4F9D;&#x6B64;&#x7C7B;&#x63A8;&#xFF0C;&#x76F4;&#x5230;&#x8BE5;DataNode&#x88AB;&#x6807;&#x8BB0;&#x4E3A;DeadNode&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x5927;&#x8BF7;&#x6C42;&#x88AB;&#x5206;&#x5272;&#x6210;&#x5F88;&#x591A;&#x4E2A;&#x5E76;&#x4E0D;&#x6210;&#x529F;&#x7684;&#x5B50;&#x8BF7;&#x6C42;&#x3002;&#x8FD9;&#x4E5F;&#x5C31;&#x89E3;&#x91CA;&#x4E86;DataNode&#x4F1A;&#x88AB;&#x8FD9;&#x4E9B;&#x65E5;&#x5FD7;&#x5237;&#x5C4F;&#x7684;&#x539F;&#x56E0;&#x3002;<br>&#x5728;DFSInputstream&#x4E0A;&#x52A0;&#x5165;&#x76F8;&#x5E94;&#x7684;&#x65E5;&#x5FD7;&#x4FE1;&#x606F;&#x540E;&#xFF0C;&#x5C06;&#x8BE5;jar&#x66FF;&#x6362;&#x5230;hbase lib&#x76EE;&#x5F55;&#x4E0B;&#x7684;&#x5BF9;&#x5E94;&#x7684;jar&#x6587;&#x4EF6;&#xFF0C;&#x6B64;&#x65F6;&#x663E;&#x793A;&#x5E76;&#x975E;&#x5982;&#x4E0A;&#x7684;&#x5047;&#x8BBE;&#xFF0C; &#x4E5F;&#x5373;&#x5728;Client&#x7AEF;&#x8BFB;&#x53D6;&#x6570;&#x636E;&#x65F6;&#x5E76;&#x6CA1;&#x6709;&#x53D1;&#x751F;&#x8FD9;&#x6837;&#x7684;&#x5F02;&#x5E38;&#xFF0C;&#x8FD9;&#x79CD;&#x53EF;&#x80FD;&#x6027;&#x60C5;&#x51B5;&#x6392;&#x9664;&#x5728;&#x5916;&#x3002;</p>
</div></article><div class="tags"><a href="../tags/大数据/">大数据</a><a href="../tags/Hadoop/">Hadoop</a><a href="../tags/DataNode/">DataNode</a><a href="../tags/日志/">日志</a></div><div class="paginator"><a href="../log_repeat_2/" class="prev"><i class="iconfont icon-left"></i><span> 上一页</span></a><a href="../hbase_spark/" class="next"><span>下一页</span><i class="iconfont icon-right"></i></a></div><section id="comments"><div id="disqus_thread"></div></section><script type="text/javascript">var disqus_config = function () {
    this.page.url = 'https://dengzhhu653.github.io/hdfs_log_repeat/';
    this.page.identifier = 'hdfs_log_repeat/';
    this.page.title = 'HDFS &quot;Not scheduling suspect block xxx for rescanning&quot;日志刷屏问题探究（1）';
};
(function() {
var d = document, s = d.createElement('script');

s.src = '//dengzhhu653.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();</script></section><footer><div class="copyright"><p class="power">Powered by <a href="https://hexo.io/">Hexo</a> and Theme by <a href="https://github.com/ahonn/hexo-theme-even"> Even</a></p><p class="since">&copy;2018<span class="heart"><i class="iconfont icon-heart"></i></span><span class="author">Zhihua Deng</span></p></div><label id="back2top"><i class="iconfont icon-up"></i></label></footer></div><script src="/js/zepto.min.js"></script><script src="/js/theme.js"></script></body></html>